
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="bashdoc" />
  <link href="https://fonts.googleapis.com/css?family=Lora:400,400italic|Work+Sans:300,400,500,600" rel="stylesheet" type="text/css"/>

  <title>potion</title>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
  </style>
  <style>
  * {
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      box-sizing: border-box;
      margin-top: 0;
  }
      html, div, body { margin:0; padding:0; }
      #toc {
        width: 25%;
        margin:50px 0 0 0;
        padding:0 2%;
        float: left;
        background: #3E4042;
        color: #dadada;
      }
      body {
      font-family: "Work sans", Helvetica, Arial, sans-serif;
      font-size: 15px;
      line-height: 1.4;
      background: #3E4042;
      }
  
      h1,h2,h3,h4,h5,h6 {
        font-family: "Work sans","Helvetica Neue", Helvetica, Arial, sans-serif;
        font-weight: 500;
      }
  
      #toc ul { padding:0; margin:0; }
      #toc > ul > li { margin-bottom: 2em; }
      #toc li { list-style: none; padding-left:0; }
      #toc ul ul { padding-left: 1.25em; }
      #toc code { display:none; }
      #toc a {
        color: #dadada;
        text-decoration: none;
      }
      #toc a:hover {
        color: #fff;
      }
      #content {
        padding: 50px 5% 50px 5%;
        margin:0 0 0 25%;
        background: #fff;
      }
  
      .section pre {
        border-radius: 10px;
        border:1px solid #dadada;
        background: #ededed;
        width:100%;
        padding:5px;
        font-family: monospace;
        font-size:120%
      }
  
      pre.sourceCode {
        border-radius: 0;
        border: 0;
        background: none;
        padding-top:10px;
        width: 100%;
        font-size: 90%;
      }
  
      .module .section {
        padding-left: 2em;
      }
  
      .module .section p::first-letter {
        text-transform: capitalize;
      }
  
      .module h4 { margin-bottom:0 !important; }
  
      p { 
        width: 80%;
        text-align: justify;
      }
  
      .module p {
        padding-left: 1em;
        color: #555;
        font-style: italic;
      }
  
    .module h2 { margin-bottom:0.2em; margin-top: 2.5em;}
    .module h2:before {
       content: "module";
       color: #888;
       font-family: monospace;
       font-size: 90%;
       padding-right:0.4em;
    }
  
    .module h3:before {
       content: "function";
       color: #888;
       font-family: monospace;
       font-size: 90%;
       padding-right:0.4em;
    }
  
    .module dl {
      padding: 0.5em;
    }
    .module dt {
      display: inline-block;
      min-width: 125px;
      font-weight: bold;
      color: #333;
    }
    .module dd:after {
      display: block;
      content: "";
    }
    .module dt:after {
      content: ":";
    }
    .module dd {
      display: inline;
      margin: 0;
    }
    .module h3 code {
      font-size: 80%;
      color: #555;
    }
  
    hr { margin-top:2em; margin-bottom: 2em; border:1px solid #555;
    background: none; }
    div.sourceCode { width: 100% !important; }
    td.lineNumbers { padding-left:0 !important; }
    .sourceCode pre { margin-bottom:0 !important; }
    .sourceCode { margin-bottom: 0.5em !important; }
  
  
  h1 code,h2 code,h3 code,h4 code,.section p code, dl code {
    background: none !important;
    color: #555 !important;
  }
  </style>
<body class="book toc2 toc-left">
<div id="toc" class="toc2">
<ul>
<li><a href="#potion">potion</a><ul>
<li><a href="#usage">Usage</a><ul>
<li><a href="#using-potion-to-run-a-recipe">Using potion to run a recipe</a></li>
<li><a href="#using-potion-to-create-a-self-executable-recipe">Using potion to create a self-executable recipe</a></li>
<li><a href="#using-potion-to-run-a-local-recipe-in-remote-host">Using potion to run a local recipe in remote host</a></li>
<li><a href="#using-potion-with-remote-recipes">Using potion with remote recipes</a></li>
<li><a href="#using-default-recipes">Using default recipes</a></li>
</ul></li>
<li><a href="#using-potion-to-run-periodically">Using potion to run periodically</a></li>
<li><a href="#writing-recipes">Writing recipes</a><ul>
<li><a href="#contexts">Contexts</a></li>
<li><a href="#artifacts">Artifacts</a></li>
</ul></li>
<li><a href="#secrets">Secrets</a></li>
<li><a href="#including-other-potion-files">Including other potion files</a></li>
<li><a href="#testing-changes">Testing changes</a></li>
<li><a href="#bonus-how-structure-your-recipes">Bonus: How structure your recipes</a></li>
</ul></li>
<li><a href="#api-reference-potion">API Reference (potion)</a><ul>
<li><a href="#dir">dir</a><ul>
<li><a href="#dirpresent-namename-options">dir::present <code>[name=]&lt;name&gt;</code> <code>[options]</code></a></li>
<li><a href="#dirabsent-namename">dir::absent <code>[name=]&lt;name&gt;</code></a></li>
<li><a href="#direxists-namefname">dir::exists <code>[name=&lt;fname&gt;]</code></a></li>
</ul></li>
<li><a href="#file">file</a><ul>
<li><a href="#fileexists-namefname-options">file::exists <code>[name=]&lt;fname&gt;</code> <code>[options]</code></a></li>
<li><a href="#filepresent-namename-options">file::present <code>[name=]&lt;name&gt;</code> <code>[options]</code></a></li>
<li><a href="#fileabsent-namename-options">file::absent <code>[name=]&lt;name&gt;</code> <code>[options]</code></a></li>
</ul></li>
<li><a href="#format">format</a><ul>
<li><a href="#formatexists-namedevice-options">format::exists <code>[name=]&lt;device&gt;</code> <code>[options]</code></a></li>
<li><a href="#formatpresent-namedevice-options">format::present <code>[name=]&lt;device&gt;</code> <code>[options]</code></a></li>
<li><a href="#formatabsent-namedevice">format::absent <code>[name=]&lt;device&gt;</code></a></li>
</ul></li>
<li><a href="#group">group</a><ul>
<li><a href="#groupexists-namegroupname">group::exists <code>[name=]&lt;groupname&gt;</code></a></li>
<li><a href="#grouppresent-namegroupname-systemtruefalse-gidgid">group::present <code>[name=]&lt;groupname&gt;</code> <code>system=&lt;true|false&gt;</code> <code>[gid=gid]</code></a></li>
<li><a href="#groupabsent-namegroupname">group::absent <code>[name=]&lt;groupname&gt;</code></a></li>
</ul></li>
<li><a href="#host">host</a><ul>
<li><a href="#hostexists-namehostname">host::exists <code>[name=]&lt;hostname&gt;</code></a></li>
<li><a href="#hostpresent-namehostname">host::present <code>[name=]&lt;hostname&gt;</code></a></li>
<li><a href="#hostabsent-namehostname">host::absent <code>[name=]&lt;hostname&gt;</code></a></li>
</ul></li>
<li><a href="#link">link</a><ul>
<li><a href="#linkexists-namelink-targetsource">link::exists <code>[name=]&lt;link&gt;</code> <code>target=&lt;source&gt;</code></a></li>
<li><a href="#linkpresent-namelink-targetsource">link::present <code>[name=]&lt;link&gt;</code> <code>target=&lt;source&gt;</code></a></li>
<li><a href="#linkabsent-namelink-targetsource">link::absent <code>[name=]&lt;link&gt;</code> <code>target=&lt;source&gt;</code></a></li>
</ul></li>
<li><a href="#mount">mount</a><ul>
<li><a href="#mountexists-namename-opts">mount::exists <code>[name=]&lt;name&gt;</code> <code>[opts]</code></a></li>
<li><a href="#mountpresent-namename-opts">mount::present <code>[name=]&lt;name&gt;</code> <code>[opts]</code></a></li>
<li><a href="#mountabsent-namename">mount::absent <code>[name=]&lt;name&gt;</code></a></li>
</ul></li>
<li><a href="#pkg">pkg</a><ul>
<li><a href="#pkgexists-namepackage">pkg::exists <code>[name=]&lt;package&gt;</code></a></li>
<li><a href="#pkgpresent-namepackage">pkg::present <code>[name=]&lt;package&gt;</code></a></li>
<li><a href="#pkgabsent-namepackage">pkg::absent <code>[name=]&lt;package&gt;</code></a></li>
</ul></li>
<li><a href="#srv">srv</a><ul>
<li><a href="#srvexists-nameservice">srv::exists <code>[name=]&lt;service&gt;</code></a></li>
<li><a href="#srvpresent-nameservice">srv::present <code>[name=]&lt;service&gt;</code></a></li>
<li><a href="#srvabsent-nameservice">srv::absent <code>[name=]&lt;service&gt;</code></a></li>
</ul></li>
<li><a href="#swap">swap</a><ul>
<li><a href="#swapexists">swap::exists</a></li>
<li><a href="#swappresent-namedevicefile-sizesize-formattruefalse">swap::present <code>[name=&lt;device|file&gt;]</code> <code>[size=&lt;size&gt;]</code> <code>[format=&lt;true|false&gt;]</code></a></li>
<li><a href="#swapabsent-namedevicefile">swap::absent <code>[name=]&lt;device|file&gt;</code></a></li>
</ul></li>
<li><a href="#tz">tz</a><ul>
<li><a href="#tzexists-namezonename">tz::exists <code>[name=]&lt;zonename&gt;</code></a></li>
<li><a href="#tzpresent-namezonename">tz::present <code>[name=]&lt;zonename&gt;</code></a></li>
<li><a href="#tzabsent-namezonename">tz::absent <code>[name=]&lt;zonename&gt;</code></a></li>
</ul></li>
<li><a href="#user">user</a><ul>
<li><a href="#userpresent-nameusername-options">user::present <code>[name=&lt;username&gt;]</code> <code>[options]</code></a></li>
<li><a href="#userabsent-nameusername-keepdatatrue">user::absent <code>[name=]&lt;username&gt;</code> <code>[keepdata=true]</code></a></li>
</ul></li>
</ul></li>
</ul>
</div>
<div id="content">
<div id="header">
<h1>potion</h1>
</div>
<section id="potion" class="level1">
<h1>potion</h1>
<p>Potion is a single application to configure a system, like Puppet or Chef, but minimalist.</p>
<section id="usage" class="level2">
<h2>Usage</h2>
<p>There are two ways to use potion:</p>
<ol type="1">
<li>You can use <code>potion</code> to run a recipe. A recipe is a script which contains the description of the configuration that you want to apply.</li>
<li>You can use potion to create a standalone autoexecutable recipe, so you don’t need potion to run a potion file.</li>
</ol>
<section id="using-potion-to-run-a-recipe" class="level3">
<h3>Using potion to run a recipe</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">potion</span> run Potionfile Otherrecipe.potion</a></code></pre></div>
<p>The recipe is any bash script which can contain a number of specific funtions, listed below in API Reference.</p>
</section>
<section id="using-potion-to-create-a-self-executable-recipe" class="level3">
<h3>Using potion to create a self-executable recipe</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">potion</span> create Potionfile <span class="op">&gt;</span> recipe.sh</a></code></pre></div>
</section>
<section id="using-potion-to-run-a-local-recipe-in-remote-host" class="level3">
<h3>Using potion to run a local recipe in remote host</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="ex">potion</span> -q create Potionfile <span class="kw">|</span> <span class="fu">ssh</span> -tt hostname</a></code></pre></div>
</section>
<section id="using-potion-with-remote-recipes" class="level3">
<h3>Using potion with remote recipes</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="ex">potion</span> run https://miremotehost/remoterecipe.potion</a></code></pre></div>
<p>Or more complex example with ssh and git:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="ex">potion</span> run ssh+git://myremoterepohost/mirepo.git</a></code></pre></div>
<p>When you point to a repo, a file called <code>init.potion</code> in the root dir of the repo is loaded automatically, as potion starting point.</p>
</section>
<section id="using-default-recipes" class="level3">
<h3>Using default recipes</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="bu">export</span> <span class="va">POTION</span>\_<span class="va">DEFAULT_SOURCE=</span><span class="st">&quot;ssh+git://myremoterepohost/mirepo.git&quot;</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="ex">potion</span> run</a></code></pre></div>
</section>
</section>
<section id="using-potion-to-run-periodically" class="level2">
<h2>Using potion to run periodically</h2>
<p>Potion does not support daemon mode, but you can use systemd timers or cron jobs to run potion every hour or when you prefer. Please note that potion requires some environment variables like <code>HOME</code>. Is a good practice tu run potion with sudo as unprivileged user, for example:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1">$ <span class="fu">id</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="va">uid=</span>1000<span class="va">(</span>user<span class="va">)</span> <span class="va">gid=</span>1000<span class="va">(</span>user<span class="va">)</span> <span class="va">groups=</span>1000<span class="va">(</span>user<span class="va">)</span></a>
<a class="sourceLine" id="cb7-3" title="3">$ <span class="fu">sudo</span> -i potion run script.potion</a></code></pre></div>
</section>
<section id="writing-recipes" class="level2">
<h2>Writing recipes</h2>
<p>Potion recipes are, in fact, bash scripts, so any thing that you can create with a bash script could be used in recipe, nevertheless we recommend you to use potion API to more common situations, and create new modules over them. Recipes are evaluated in order, but you parallelize actions using context (read more below).</p>
<section id="contexts" class="level3">
<h3>Contexts</h3>
<p>A context is a new process running by potion to perform some task in parallel. You can configure context with the following syntax in the Potion file:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="ex">@context1</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">{</span></a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="co"># do some actions</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="kw">}</span></a>
<a class="sourceLine" id="cb8-5" title="5"></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="ex">@context2</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="kw">{</span></a>
<a class="sourceLine" id="cb8-8" title="8">  <span class="co"># do other actions</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="kw">}</span></a></code></pre></div>
<p>In this example we create two context which will be running in parallel in the host.</p>
</section>
<section id="artifacts" class="level3">
<h3>Artifacts</h3>
<p>An artifact is a set of files which should be included in the potion file and deployed by Potion application. You can think an artifact like a template for file. You can use artifacts like any other file, in the form:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1"><span class="ex">file</span>::present /etc/config.json \</a>
<a class="sourceLine" id="cb9-2" title="2">  data=<span class="st">&quot;artifact://config.json&quot;</span></a></code></pre></div>
<p>This code will create (if doesn’t exist yet) a fil in <code>/etc/config.json</code>, which content is generated from artifact called <code>config.json</code>. The artifacts directory must be specified by command like when called potion, like the following example:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1"><span class="ex">potion</span> run -a ./artifacts_dir Potionfile</a></code></pre></div>
<p>If you generate a self-executable potion file, the artifacts will be included in the script.</p>
<p>Instead of <code>artifact://</code> url, you can use <code>artifact+eval://</code> url, which allows you to expand variables inside the artifact file. You can use normal <code>$variable</code> form, or even run more complex like <code>$(if $var; then echo value; fi)</code>.</p>
<p>You can also load artifacts programatically from the potion recipe, using <code>artifact::load</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1"><span class="ex">artifact</span>::load ./path/to/artifactsdir</a></code></pre></div>
</section>
</section>
<section id="secrets" class="level2">
<h2>Secrets</h2>
<p>Secrets are intented to keep some variables of your config in secret. Potion will add secret variables using module <code>secret</code>, documented in the API. The secret file is just another potion file which contains <code>secret::add</code> commands, which define secret values in plain.</p>
<p>There are three different ways to use secrets:</p>
<ol type="1">
<li><p>Keep you secret file out of the recipes, and copy on each host individually. The run potion with <code>-s</code> (<code>--secret</code>) flag pointing to the secret file.</p></li>
<li><p>Use symmetric encryption (recommended method). Potion will read a passphrase from <code>/etc/potion.key</code> (or where <code>SECRET_MASTERKEY</code> environment variable defines) and use that passphrase to decrypt the secret file (using AES256 via openssl).</p></li>
<li><p>Using asymetric encyption via GnuPG, using different keyfiles for each host. This is the most secure way, but hard to maintain.</p></li>
</ol>
<p>Recomended option is to set a plain <code>secret.potion</code> file outside your recipes repository and encrypt it with:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1"><span class="ex">openssl</span> enc -e -a -aes256 -in secret.potion -out secret.potion.aes</a></code></pre></div>
<p>And keep <code>secret.potion.aes</code> (encrypted file) under version control system (The <code>-a</code> flag in openssl indicates to encode the file using base64, which is used by potion too). This methid provide a reasonable security and a goo way to manage the secrets from central repository.</p>
<p>Of course, you can load secrets programatically, for example:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1"><span class="ex">secret</span>::load <span class="st">&quot;crypt+file://</span><span class="va">$PWD</span><span class="st">/secrets.potion.aes&quot;</span></a></code></pre></div>
<p>This example using openssl encrypt (<code>crypt</code>) method to decrupt secrets file. In API documentation, under module <code>secret</code> you can see different load formats, including plain and gpg ones.</p>
</section>
<section id="including-other-potion-files" class="level2">
<h2>Including other potion files</h2>
<p>You can split your config in different modules, and you can load them from the starting potion file (<code>init.potion</code> if you are loading recipes from repository). See the <code>include</code> module to learn in which ways you can include other modules, but in general you will use the following:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1"><span class="ex">include</span>::path ./modules/<span class="dt">\*</span>.potion</a></code></pre></div>
</section>
<section id="testing-changes" class="level2">
<h2>Testing changes</h2>
<p>Before to apply changes, you probably want to test the changes, to do that you can run potion with <code>--pretend</code> flag. If you are running and self-executable potion, you can use the environment variable <code>$PRETEND=true</code> to ensure that the potion just pretending instead on real running.</p>
</section>
<section id="bonus-how-structure-your-recipes" class="level2">
<h2>Bonus: How structure your recipes</h2>
<p>There is no unique way to structure your recipes, depends of how complex your configuration is, but in general, this is a good approach:</p>
<ol type="1">
<li>Put your artifacts under <code>artifacts/</code> directory</li>
<li>Create modules under <code>modules/</code> to configure some software (i.e. module <code>nginx</code>). Module should have a <code>::present</code>, <code>::exists</code> and <code>::absent</code> functions.</li>
<li>Create modules under <code>profiles/</code> to help you to group core actions. For example profile <code>webserver</code> will use module <code>nginx</code> and other to configure a webserver.</li>
<li>Create modules under <code>roles/</code> to group profiles. For example <code>frontend</code> role will use webserver and others to configure what a frontend server is.</li>
<li>Finally modules under <code>nodes/</code> and named like FQDN of the node, will include roles that defined those server.</li>
</ol>
<p>Of course, you can follow any other approach that be convenient for you, this is just a recommendation.</p>
<hr />
</section>
</section>
<section id="api-reference-potion" class="level1">
<h1>API Reference (potion)</h1>
<section id="dir" class="level2 module">
<h2>dir</h2>
<p>The <code>dir</code> module provides functions to ensure that specified directory is created or destroyed.</p>
<section id="usage-example" class="level4">
<h4>Usage example</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" title="1"><span class="ex">dir</span>::present <span class="st">&quot;/mnt&quot;</span> mode=0755</a></code></pre></div>
</section>
<section id="dirpresent-namename-options" class="level3 function">
<h3>dir::present <code>[name=]&lt;name&gt;</code> <code>[options]</code></h3>
<p>ensure that specified directory name passed as argument exists, and create it if not.</p>
<section id="parameters" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>name</code></dt>
<dd>the name of the directory to be created.
</dd>
<dt><code>mode</code></dt>
<dd>the four digit octal mode of the new directory (0755) by default.
</dd>
<dt><code>user</code></dt>
<dd>the user owner the directory (root by default).
</dd>
<dt><code>group</code></dt>
<dd>the group owner the directory (root by default)
</dd>
</dl>
</section>
</section>
<section id="dirabsent-namename" class="level3 function">
<h3>dir::absent <code>[name=]&lt;name&gt;</code></h3>
<p>ensure that directory named as arguement, does not exist, removing it if necessary.</p>
<section id="parameters-1" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>name</code></dt>
<dd>the name of the directory to be removed
</dd>
</dl>
</section>
</section>
<section id="direxists-namefname" class="level3 function">
<h3>dir::exists <code>[name=&lt;fname&gt;]</code></h3>
<p>return true if directory name passed as argument exists, or false otherwise.</p>
</section>
</section>
<section id="file" class="level2 module">
<h2>file</h2>
<p>The <code>file</code> module provides functions to ensure that specified file exists or not in the system and also has specified content. To creat content, use the <code>content</code> parameter, usually this parameter accepts a URL (in the usual curl accepted format or <code>artifact://</code> to read from static artifact or <code>artifact+eval://</code> to read from an evaluated artifact.</p>
<section id="usage-example-1" class="level4">
<h4>Usage example</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" title="1"><span class="ex">file</span>::present /etc/somefile \</a>
<a class="sourceLine" id="cb16-2" title="2">  content=<span class="st">&quot;artifact://someartifact&quot;</span></a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb17-1" title="1"><span class="ex">file</span>::present /etc/otherfile \</a>
<a class="sourceLine" id="cb17-2" title="2">  content=<span class="st">&quot;some string content&quot;</span></a></code></pre></div>
</section>
<section id="fileexists-namefname-options" class="level3 function">
<h3>file::exists <code>[name=]&lt;fname&gt;</code> <code>[options]</code></h3>
<p>return true if file exists, or none otherwise</p>
<section id="parameters-2" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>name</code></dt>
<dd>the filename to check for.
</dd>
<dt><code>content</code></dt>
<dd>the content URL
</dd>
</dl>
</section>
</section>
<section id="filepresent-namename-options" class="level3 function">
<h3>file::present <code>[name=]&lt;name&gt;</code> <code>[options]</code></h3>
<p>ensure that file passed as argument exists.</p>
<section id="parameters-3" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>name</code></dt>
<dd>then file name to ensure
</dd>
<dt><code>user</code></dt>
<dd>the user owner the file
</dd>
<dt><code>group</code></dt>
<dd>the group owner the file
</dd>
<dt><code>mode</code></dt>
<dd>the four digit octal mode of the file (i.e. 0644)
</dd>
<dt><code>content</code></dt>
<dd>the content url
</dd>
</dl>
</section>
</section>
<section id="fileabsent-namename-options" class="level3 function">
<h3>file::absent <code>[name=]&lt;name&gt;</code> <code>[options]</code></h3>
<p>ensure that file passed as argument does not exist.</p>
<section id="parameters-4" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>content</code></dt>
<dd>the content url (only removes the file if content is the same).
</dd>
</dl>
</section>
</section>
</section>
<section id="format" class="level2 module">
<h2>format</h2>
<p>The <code>format</code> module provides a way to format and mount specified block devices.</p>
<section id="usage-example-2" class="level4">
<h4>Usage example</h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb18-1" title="1"><span class="ex">format</span>::present /dev/sda1 fstype=xfs</a></code></pre></div>
</section>
<section id="formatexists-namedevice-options" class="level3 function">
<h3>format::exists <code>[name=]&lt;device&gt;</code> <code>[options]</code></h3>
<p>return true if device exists and it’s mounted on mountpoint</p>
<section id="parameters-5" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>name</code></dt>
<dd>the device name
</dd>
</dl>
</section>
</section>
<section id="formatpresent-namedevice-options" class="level3 function">
<h3>format::present <code>[name=]&lt;device&gt;</code> <code>[options]</code></h3>
<p>ensure that specified device has format</p>
<section id="parameters-6" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>name</code></dt>
<dd>the device to be initialized
</dd>
<dt><code>fstype</code></dt>
<dd>the filesystem type to format the device
</dd>
</dl>
</section>
</section>
<section id="formatabsent-namedevice" class="level3 function">
<h3>format::absent <code>[name=]&lt;device&gt;</code></h3>
<p>ensure that specific device is not formatted.</p>
</section>
</section>
<section id="group" class="level2 module">
<h2>group</h2>
<p>The <code>group</code> module offers a way to ensure that specified group of uses is created or not in the system.</p>
<section id="usage-example-3" class="level4">
<h4>Usage example</h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb19-1" title="1"><span class="ex">group</span>::present mygroup</a></code></pre></div>
</section>
<section id="groupexists-namegroupname" class="level3 function">
<h3>group::exists <code>[name=]&lt;groupname&gt;</code></h3>
<p>return true or false if the specific groupname exists or not, respectively.</p>
</section>
<section id="grouppresent-namegroupname-systemtruefalse-gidgid" class="level3 function">
<h3>group::present <code>[name=]&lt;groupname&gt;</code> <code>system=&lt;true|false&gt;</code> <code>[gid=gid]</code></h3>
<p>create group if not exists</p>
<section id="parameters-7" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>name</code></dt>
<dd>the name of the group to create.
</dd>
<dt><code>system</code></dt>
<dd>if true create a system group.
</dd>
<dt><code>gid</code></dt>
<dd>the GID of the new group
</dd>
</dl>
</section>
</section>
<section id="groupabsent-namegroupname" class="level3 function">
<h3>group::absent <code>[name=]&lt;groupname&gt;</code></h3>
<p>destroy groupname if exists</p>
</section>
</section>
<section id="host" class="level2 module">
<h2>host</h2>
<p>The <code>host</code> module provides functions to configure hostname of the machine.</p>
<section id="usage-example-4" class="level4">
<h4>Usage example</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb20-1" title="1"><span class="ex">host</span>::present myhost.mydomain.com</a></code></pre></div>
</section>
<section id="hostexists-namehostname" class="level3 function">
<h3>host::exists <code>[name=]&lt;hostname&gt;</code></h3>
<p>return true if the FQDN of the node is equal to specified one.</p>
</section>
<section id="hostpresent-namehostname" class="level3 function">
<h3>host::present <code>[name=]&lt;hostname&gt;</code></h3>
<p>ensure than the node has the specified hostname.</p>
</section>
<section id="hostabsent-namehostname" class="level3 function">
<h3>host::absent <code>[name=]&lt;hostname&gt;</code></h3>
<p>ensure than the node has not the specified hostname.</p>
</section>
</section>
<section id="link" class="level2 module">
<h2>link</h2>
<p>The <code>link</code> module provides functions to ensure that specified symlink exists in the system and points to specified file.</p>
<section id="usage-example-5" class="level4">
<h4>Usage example</h4>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb21-1" title="1"><span class="ex">link</span>::present /mylink target=/etc/motd</a></code></pre></div>
</section>
<section id="linkexists-namelink-targetsource" class="level3 function">
<h3>link::exists <code>[name=]&lt;link&gt;</code> <code>target=&lt;source&gt;</code></h3>
<p>returnt true if the specified link exists and point to source.</p>
<section id="parameters-8" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>target</code></dt>
<dd>the target where link points to
</dd>
</dl>
</section>
</section>
<section id="linkpresent-namelink-targetsource" class="level3 function">
<h3>link::present <code>[name=]&lt;link&gt;</code> <code>target=&lt;source&gt;</code></h3>
<p>ensure that the link exists and point to source.</p>
<section id="parameters-9" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>target</code></dt>
<dd>the target where link points to
</dd>
</dl>
</section>
</section>
<section id="linkabsent-namelink-targetsource" class="level3 function">
<h3>link::absent <code>[name=]&lt;link&gt;</code> <code>target=&lt;source&gt;</code></h3>
<p>ensure that the specified link does not exists or not point to specified source.</p>
<section id="parameters-10" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>target</code></dt>
<dd>the target where link points to
</dd>
</dl>
</section>
</section>
</section>
<section id="mount" class="level2 module">
<h2>mount</h2>
<p>The <code>mount</code> module provides functions to ensure that specific mountpoint is mounted.</p>
<section id="usage-example-6" class="level4">
<h4>Usage example</h4>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb22-1" title="1"><span class="ex">mount</span>::present /mnt device=/dev/sda1 fstype=xfs</a></code></pre></div>
</section>
<section id="mountexists-namename-opts" class="level3 function">
<h3>mount::exists <code>[name=]&lt;name&gt;</code> <code>[opts]</code></h3>
<p>return true if specific device is mounted with passed options</p>
<section id="parameters-11" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>device</code></dt>
<dd>the device to mount
</dd>
<dt><code>fstype</code></dt>
<dd>the fstype of the device filesystem (default: auto)
</dd>
</dl>
</section>
</section>
<section id="mountpresent-namename-opts" class="level3 function">
<h3>mount::present <code>[name=]&lt;name&gt;</code> <code>[opts]</code></h3>
<p>ensure that specific device is mounted according with passed options.</p>
<section id="parameters-12" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>device</code></dt>
<dd>the device to mount
</dd>
<dt><code>fstype</code></dt>
<dd>the fstype of the device filesystem (default: auto)
</dd>
</dl>
</section>
</section>
<section id="mountabsent-namename" class="level3 function">
<h3>mount::absent <code>[name=]&lt;name&gt;</code></h3>
<p>ensure that specific mount point is not mounted.</p>
</section>
</section>
<section id="pkg" class="level2 module">
<h2>pkg</h2>
<p>The <code>pkg</code> module provides functions to ensure package installation on the system.</p>
<section id="usage-example-7" class="level4">
<h4>Usage example</h4>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb23-1" title="1"><span class="ex">pkg</span>::present vim</a></code></pre></div>
</section>
<section id="pkgexists-namepackage" class="level3 function">
<h3>pkg::exists <code>[name=]&lt;package&gt;</code></h3>
<p>return true if the specific package is present in the system.</p>
</section>
<section id="pkgpresent-namepackage" class="level3 function">
<h3>pkg::present <code>[name=]&lt;package&gt;</code></h3>
<p>ensure that specified package is installed on the system.</p>
</section>
<section id="pkgabsent-namepackage" class="level3 function">
<h3>pkg::absent <code>[name=]&lt;package&gt;</code></h3>
<p>ensure that specified package is not present on the system.</p>
</section>
</section>
<section id="srv" class="level2 module">
<h2>srv</h2>
<p>The <code>srv</code> module provides high-level functions to manage package installations.</p>
<section id="usage-example-8" class="level4">
<h4>Usage example</h4>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb24-1" title="1"><span class="ex">srv</span>::present sshd</a></code></pre></div>
</section>
<section id="srvexists-nameservice" class="level3 function">
<h3>srv::exists <code>[name=]&lt;service&gt;</code></h3>
<p>return true if the specific service is present in the system.</p>
</section>
<section id="srvpresent-nameservice" class="level3 function">
<h3>srv::present <code>[name=]&lt;service&gt;</code></h3>
<p>ensure that specified service is installed on the system.</p>
</section>
<section id="srvabsent-nameservice" class="level3 function">
<h3>srv::absent <code>[name=]&lt;service&gt;</code></h3>
<p>ensure that specified service is not present on the system.</p>
</section>
</section>
<section id="swap" class="level2 module">
<h2>swap</h2>
<p>The <code>swap</code> module contains functions to create and configure swap space.</p>
<section id="usage-example-9" class="level4">
<h4>Usage example</h4>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb25-1" title="1"><span class="ex">swap</span>::present \</a>
<a class="sourceLine" id="cb25-2" title="2">  /tmp/swapfile \</a>
<a class="sourceLine" id="cb25-3" title="3">  size=1G \</a>
<a class="sourceLine" id="cb25-4" title="4">  format=true</a></code></pre></div>
</section>
<section id="swapexists" class="level3 function">
<h3>swap::exists</h3>
<p>return true if swap is enabled</p>
</section>
<section id="swappresent-namedevicefile-sizesize-formattruefalse" class="level3 function">
<h3>swap::present <code>[name=&lt;device|file&gt;]</code> <code>[size=&lt;size&gt;]</code> <code>[format=&lt;true|false&gt;]</code></h3>
<p>ensure that swap is enable in specified device or file and specified size.</p>
<section id="parameters-13" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>name</code></dt>
<dd>the device use as swap space.
</dd>
<dt><code>size</code></dt>
<dd>the size required if swap file is created
</dd>
<dt><code>format</code></dt>
<dd>if true, format swap space.
</dd>
</dl>
</section>
</section>
<section id="swapabsent-namedevicefile" class="level3 function">
<h3>swap::absent <code>[name=]&lt;device|file&gt;</code></h3>
<p>ensure that specified device is not enabled for swap</p>
<section id="parameters-14" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>name</code></dt>
<dd>the device use as swap space.
</dd>
</dl>
</section>
</section>
</section>
<section id="tz" class="level2 module">
<h2>tz</h2>
<p>The <code>tz</code> module provides functions to configure timezone in the system.</p>
<section id="environment-variables" class="level4">
<h4>Environment variables</h4>
<dl>
<dt><code>TZ_DIR</code></dt>
<dd>path where zoneinfo live. By default <code>/usr/share/zoneinfo</code>.
</dd>
</dl>
</section>
<section id="usage-example-10" class="level4">
<h4>Usage example</h4>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb26-1" title="1"><span class="ex">tz</span>::present Europe/Madrid</a></code></pre></div>
</section>
<section id="tzexists-namezonename" class="level3 function">
<h3>tz::exists <code>[name=]&lt;zonename&gt;</code></h3>
<p>if timezone especified in argument is set return true, otherwise return false.</p>
</section>
<section id="tzpresent-namezonename" class="level3 function">
<h3>tz::present <code>[name=]&lt;zonename&gt;</code></h3>
<p>ensure that specified timezone is set.</p>
</section>
<section id="tzabsent-namezonename" class="level3 function">
<h3>tz::absent <code>[name=]&lt;zonename&gt;</code></h3>
<p>ensure that the specified timezone is not set.</p>
</section>
</section>
<section id="user" class="level2 module">
<h2>user</h2>
<p>The <code>user</code> module provides functions to manage users in the system.</p>
<section id="usage-example-11" class="level4">
<h4>Usage example</h4>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb27-1" title="1"><span class="ex">group</span>::present mygroup</a>
<a class="sourceLine" id="cb27-2" title="2"><span class="ex">user</span>::present someuser \</a>
<a class="sourceLine" id="cb27-3" title="3">  groups=adm,mygroup \</a>
<a class="sourceLine" id="cb27-4" title="4">  nohome=true \</a>
<a class="sourceLine" id="cb27-5" title="5">  system=true \</a>
<a class="sourceLine" id="cb27-6" title="6">  shel=/bin/false</a></code></pre></div>
</section>
<section id="userpresent-nameusername-options" class="level3 function">
<h3>user::present <code>[name=&lt;username&gt;]</code> <code>[options]</code></h3>
<p>create user if not exists</p>
<section id="parameters-15" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>basedir</code></dt>
<dd>set the base director to create home directories.
</dd>
<dt><code>gecos</code></dt>
<dd>set the GECOS field in user record.
</dd>
<dt><code>groups</code></dt>
<dd>a comma separated list of groups for the user.
</dd>
<dt><code>nohome</code></dt>
<dd>if true do not create home directory (false by default).
</dd>
<dt><code>system</code></dt>
<dd>if true create system user (false by default).
</dd>
<dt><code>uid</code></dt>
<dd>if set, try to force that UID as user id for the new user.
</dd>
<dt><code>shell</code></dt>
<dd>set the shell of the username.
</dd>
<dt><code>password</code></dt>
<dd>the password for the user
</dd>
</dl>
</section>
</section>
<section id="userabsent-nameusername-keepdatatrue" class="level3 function">
<h3>user::absent <code>[name=]&lt;username&gt;</code> <code>[keepdata=true]</code></h3>
<p>destroy username if exists</p>
<section id="parameters-16" class="level4">
<h4>Parameters</h4>
<dl>
<dt><code>keepdata</code></dt>
<dd>if true do not remove user data.
</dd>
</dl>
<hr />
</section>
</section>
</section>
</section>
</div>
</body>

